<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Controller Test - Kurukshetra Mitra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui; background: linear-gradient(135deg, #fdfbf7 0%, #e6d5c3 100%); min-height: 100vh; padding: 2rem; }
        .container { max-width: 1200px; margin: 0 auto; }
        .hero { text-align: center; margin-bottom: 2rem; }
        .hero h1 { font-size: 2.5rem; color: #8B4513; margin-bottom: 0.5rem; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 2rem 0; }
        .status-card { background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .status-label { font-size: 0.9rem; color: #666; margin-bottom: 0.5rem; }
        .status-value { font-size: 1.3rem; font-weight: bold; color: #8B4513; }
        .status-value.good { color: #27ae60; }
        .status-value.bad { color: #e74c3c; }
        .card { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 40px rgba(139,69,19,0.15); margin-bottom: 2rem; }
        .card-title { font-size: 1.5rem; color: #8B4513; margin-bottom: 1.5rem; border-bottom: 2px solid #e6d5c3; padding-bottom: 1rem; }
        .btn { padding: 1rem 2rem; background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; margin: 0.5rem; transition: transform 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .search-box { width: 100%; padding: 1rem; font-size: 1.1rem; border: 3px solid #8B4513; border-radius: 50px; margin-bottom: 1.5rem; }
        .event-log { background: #f8f9fa; padding: 1.5rem; border-radius: 10px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.9rem; }
        .event-item { padding: 0.5rem; border-left: 3px solid #8B4513; margin-bottom: 0.5rem; background: white; }
        .view-display { background: #fffaf0; padding: 2rem; border-radius: 15px; border-left: 4px solid #d4af37; margin-top: 1.5rem; }
        .view-title { font-size: 1.3rem; font-weight: 600; color: #8B4513; margin-bottom: 1rem; }
        .state-display { background: #fff; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>ğŸ® UI Controller Test</h1>
            <p style="color: #666;">The Brain That Orchestrates Everything</p>
        </div>
        
        <div class="status-grid" id="statusGrid"></div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-search"></i> Search Test</h2>
            <input type="search" id="searchInput" class="search-box" placeholder="Type and press Enter to search...">
            <p style="color: #666; text-align: center;">ğŸ’¡ Try: brahma, gita, jyotisar, temple</p>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-hand-pointer"></i> Action Tests</h2>
            <button class="btn" onclick="testSiteSelect()"><i class="fas fa-map-marker"></i> View Site (ID: 1)</button>
            <button class="btn" onclick="testWeather()"><i class="fas fa-cloud-sun"></i> View Weather</button>
            <button class="btn" onclick="testEvents()"><i class="fas fa-calendar"></i> View Events</button>
            <button class="btn" onclick="testDirections()"><i class="fas fa-route"></i> View Directions</button>
            <button class="btn" onclick="testGoBack()"><i class="fas fa-arrow-left"></i> Go Back</button>
            <button class="btn" onclick="testError()"><i class="fas fa-exclamation-triangle"></i> Test Error</button>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-eye"></i> Current View</h2>
            <div class="view-display" id="viewDisplay"></div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-database"></i> Current State</h2>
            <div class="state-display" id="stateDisplay"></div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-stream"></i> Event Log</h2>
            <button class="btn" onclick="clearEventLog()" style="margin-bottom: 1rem;"><i class="fas fa-trash"></i> Clear Log</button>
            <div class="event-log" id="eventLog"></div>
        </div>
    </div>
    
    <script src="js/platform-detector.js"></script>
    <script src="js/tour-guide-data.js"></script>
    <script src="js/questions-data.js"></script>
    <script src="js/autocomplete.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui-controller.js"></script>
    <script>
        console.log('ğŸ‰ UI Controller Test Page Loading...');
        
        const eventLogEl = document.getElementById('eventLog');
        const events = [];
        
        function logEvent(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            events.unshift({ type, message, timestamp });
            if (events.length > 20) events.pop();
            eventLogEl.innerHTML = events.map(e => 
                `<div class="event-item">[${e.timestamp}] <strong>${e.type}:</strong> ${e.message}</div>`
            ).join('');
        }
        
        function clearEventLog() {
            events.length = 0;
            eventLogEl.innerHTML = '';
        }
        
        // Initialize UI Controller
        const ui = UIController.init({
            searchInput: document.getElementById('searchInput'),
            useMockData: true
        });
        
        logEvent('INIT', 'UI Controller initialized');
        
        // Subscribe to all events
        ui.on('state:change', (data) => {
            logEvent('STATE', `Updated: ${Object.keys(data.updates).join(', ')}`);
            updateStateDisplay();
        });
        
        ui.on('view:change', (data) => {
            logEvent('VIEW', `${data.from} â†’ ${data.to}`);
            updateViewDisplay();
        });
        
        ui.on('view:rendered', (data) => {
            logEvent('RENDER', `View rendered: ${data.view}`);
        });
        
        ui.on('loading:show', (data) => {
            logEvent('LOADING', `Show: ${data.message}`);
        });
        
        ui.on('loading:hide', () => {
            logEvent('LOADING', 'Hide');
        });
        
        ui.on('error:show', (data) => {
            logEvent('ERROR', data.message);
        });
        
        ui.on('error:clear', () => {
            logEvent('ERROR', 'Cleared');
        });
        
        // Update status
        function updateStatus() {
            const modules = ui.getModules();
            const state = ui.getState();
            document.getElementById('statusGrid').innerHTML = `
                <div class="status-card">
                    <div class="status-label">Controller</div>
                    <div class="status-value good">${ui.isReady() ? 'âœ… Ready' : 'âŒ Not Ready'}</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Current View</div>
                    <div class="status-value">${state.currentView}</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Modules Loaded</div>
                    <div class="status-value good">${Object.values(modules).filter(Boolean).length}/5</div>
                </div>
                <div class="status-card">
                    <div class="status-label">History</div>
                    <div class="status-value">${state.history.length} views</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Loading</div>
                    <div class="status-value ${state.isLoading ? 'bad' : 'good'}">${state.isLoading ? 'â³ Yes' : 'âœ… No'}</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Error</div>
                    <div class="status-value ${state.hasError ? 'bad' : 'good'}">${state.hasError ? 'âŒ Yes' : 'âœ… No'}</div>
                </div>
            `;
        }
        
        function updateViewDisplay() {
            const state = ui.getState();
            document.getElementById('viewDisplay').innerHTML = `
                <div class="view-title">Current: ${state.currentView}</div>
                <p><strong>Previous:</strong> ${state.previousView || 'None'}</p>
                <p><strong>Selected Site:</strong> ${state.selectedSite?.name || 'None'}</p>
                <p><strong>Search Query:</strong> ${state.searchQuery || 'None'}</p>
                <p><strong>Search Results:</strong> ${state.searchResults.length} items</p>
            `;
        }
        
        function updateStateDisplay() {
            const state = ui.getState();
            document.getElementById('stateDisplay').textContent = JSON.stringify({
                currentView: state.currentView,
                isLoading: state.isLoading,
                hasError: state.hasError,
                searchQuery: state.searchQuery,
                searchResults: state.searchResults.length,
                historyLength: state.history.length
            }, null, 2);
        }
        
        // Test functions
        function testSiteSelect() {
            ui.handleSiteSelect(1);
        }
        
        function testWeather() {
            ui.handleViewWeather();
        }
        
        function testEvents() {
            ui.handleViewEvents();
        }
        
        function testDirections() {
            ui.handleViewDirections('Delhi');
        }
        
        function testGoBack() {
            ui.goBack();
        }
        
        function testError() {
            ui.showError('This is a test error!');
            setTimeout(() => ui.clearError(), 3000);
        }
        
        // Initial update
        updateStatus();
        updateViewDisplay();
        updateStateDisplay();
        
        // Auto-refresh status every 2 seconds
        setInterval(updateStatus, 2000);
        
        console.log('âœ… Test page ready!');
        console.log('');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('ğŸ® UI CONTROLLER LOADED!');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('');
        console.log('ğŸ“Š Module Status:');
        const modules = ui.getModules();
        console.log(`   Platform: ${modules.platform ? 'âœ…' : 'âŒ'}`);
        console.log(`   TourGuide: ${modules.tourGuide ? 'âœ…' : 'âŒ'}`);
        console.log(`   Questions: ${modules.questions ? 'âœ…' : 'âŒ'}`);
        console.log(`   Autocomplete: ${modules.autocomplete ? 'âœ…' : 'âŒ'}`);
        console.log(`   API: ${modules.api ? 'âœ…' : 'âŒ'}`);
        console.log('');
        console.log('ğŸ’¡ Try:');
        console.log('   - Type in search box and press Enter');
        console.log('   - Click action buttons');
        console.log('   - Watch event log update');
        console.log('   - Check state changes');
        console.log('');
    </script>
</body>
</html>
